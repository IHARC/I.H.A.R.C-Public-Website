---
import { footer, integrations } from '../data/site';
import Logo from './Logo.astro';

// Helper functions to detect placeholder data
const isPlaceholderPhone = (phone: string) => phone.includes('555-') || phone.includes('TODO');
const isPlaceholderEmail = (email: string) => email.includes('TODO') || !email.includes('@');
const isPlaceholderAddress = (address: string[]) => address.some(line => line.includes('TODO') || line.includes('123 Main Street'));
const isPlaceholderSocial = (href: string) => href.includes('TODO') || href.includes('facebook.com/iharc') || href.includes('twitter.com/iharc') || href.includes('linkedin.com/company/iharc');

// Check if we have real contact info
const hasRealContactInfo = !isPlaceholderPhone(footer.contact.phone) && 
                           !isPlaceholderEmail(footer.contact.email) && 
                           !isPlaceholderAddress(footer.contact.address);

// Filter out placeholder social links
const realSocialLinks = footer.social.filter(social => !isPlaceholderSocial(social.href));

// Social media icon mapping
const socialIcons: Record<string, string> = {
  Facebook: 'M18.77 7.46H15.5v-1.9c0-.9.6-1.1 1-1.1h2.18V2.38h-3.06C13.54 2.38 12 3.92 12 6.04v1.42H9.5v2.28H12v7.88h3.5v-7.88h2.48l.29-2.28z',
  Twitter: 'M23.32 4.56c-.8.35-1.66.59-2.56.69a4.5 4.5 0 001.97-2.47 9.07 9.07 0 01-2.87 1.09A4.48 4.48 0 0016.1 2a4.52 4.52 0 00-4.52 4.52c0 .35.04.7.11 1.04A12.81 12.81 0 013.45 3.17a4.533 4.533 0 001.4 6.03 4.48 4.48 0 01-2.04-.56v.06a4.52 4.52 0 003.63 4.43 4.52 4.52 0 01-2.04.08 4.52 4.52 0 004.22 3.14A9.05 9.05 0 012 18.13 12.77 12.77 0 008.96 20c8.35 0 12.9-6.92 12.9-12.9 0-.2 0-.39-.01-.58A9.23 9.23 0 0024 4.59l-0.68.03z',
  LinkedIn: 'M20.45 20.45h-3.56v-5.57c0-1.33-.03-3.04-1.85-3.04-1.85 0-2.14 1.45-2.14 2.95v5.66H9.34V9h3.41v1.56h.05c.48-.9 1.64-1.85 3.37-1.85 3.6 0 4.27 2.37 4.27 5.45v6.3zM5.34 7.43c-1.14 0-2.07-.93-2.07-2.07s.93-2.07 2.07-2.07 2.07.93 2.07 2.07-.93 2.07-2.07 2.07zM7.12 20.45H3.56V9h3.56v11.45z',
};
---

<footer class="bg-white border-t border-gray-200">
  <!-- CTA Band -->
  <section class="bg-brand-red text-white">
    <div class="container py-12">
      <div class="text-center">
        <h2 class="text-2xl lg:text-3xl font-heading font-bold mb-4">
          Partner with us to improve safety and health across Northumberland.
        </h2>
        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center mt-8">
          <a href="/donate" class="btn-white">
            Donate Now
          </a>
          <a href="/volunteer" class="btn-secondary border-white text-white hover:bg-white hover:text-brand-red">
            Volunteer
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Footer Content -->
  <div class="container py-12">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-8">
      <!-- Organization Info -->
      <div class="lg:col-span-1">
        <Logo 
          variant={integrations.logo.variants.footer} 
          size="md" 
          class="mb-4" 
          alt="IHARC - Integrated Homelessness & Addictions Response Centre" 
        />
        <p class="text-gray-600 mb-4 leading-relaxed">
          Integrated Homelessness & Addictions Response Centre serving Northumberland County with comprehensive support and community safety initiatives.
        </p>
        {hasRealContactInfo ? (
          <div class="space-y-2 text-sm text-gray-600">
            {footer.contact.address.map((line) => (
              <p>{line}</p>
            ))}
            <p>
              <a href={`tel:${footer.contact.phone}`} class="hover:text-brand-red transition-colors">
                {footer.contact.phone}
              </a>
            </p>
            <p>
              <a href={`mailto:${footer.contact.email}`} class="hover:text-brand-red transition-colors">
                {footer.contact.email}
              </a>
            </p>
          </div>
        ) : (
          <div class="text-sm text-gray-500 italic">
            <p>Contact information will be updated soon.</p>
            <p class="mt-2">
              <a href="/contact" class="text-brand-red hover:underline">
                Visit our contact page for current information
              </a>
            </p>
          </div>
        )}
      </div>

      <!-- Footer Sections -->
      {footer.sections.map((section) => (
        <div>
          <h3 class="text-lg font-heading font-semibold text-gray-900 mb-4">
            {section.title}
          </h3>
          <ul class="space-y-2">
            {section.links.map((link) => (
              <li>
                <a
                  href={link.href}
                  class="text-gray-600 hover:text-brand-red transition-colors focus:outline-none focus:ring-2 focus:ring-brand-red focus:ring-offset-2 rounded"
                  {...(link.external && { target: "_blank", rel: "noopener noreferrer" })}
                >
                  {link.label}
                  {link.external && (
                    <span class="ml-1 text-xs" aria-label="(opens in new tab)">↗</span>
                  )}
                </a>
              </li>
            ))}
          </ul>
        </div>
      ))}
    </div>

    <!-- Social Links -->
    {realSocialLinks.length > 0 && (
      <div class="border-t border-gray-200 pt-8 mb-8">
        <h3 class="text-lg font-heading font-semibold text-gray-900 mb-4">Follow Us</h3>
        <div class="flex space-x-4">
          {realSocialLinks.map((social) => (
            <a
              href={social.href}
              class="flex items-center justify-center w-10 h-10 bg-brand-red text-white rounded-full hover:bg-brand-redDark transition-colors focus:outline-none focus:ring-2 focus:ring-brand-red focus:ring-offset-2"
              target="_blank"
              rel="noopener noreferrer"
              aria-label={`Follow us on ${social.label}`}
            >
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path d={socialIcons[social.label] || socialIcons.Facebook} />
              </svg>
            </a>
          ))}
        </div>
      </div>
    )}

    {realSocialLinks.length === 0 && (
      <div class="border-t border-gray-200 pt-8 mb-8 text-center">
        <p class="text-sm text-gray-500 italic">
          Social media links will be available soon.
        </p>
      </div>
    )}

    <!-- Bottom Bar -->
    <div class="border-t border-gray-200 pt-8 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
      <div class="text-gray-500 text-sm">
        © {new Date().getFullYear()} IHARC. All rights reserved.
      </div>
      
      <nav class="flex space-x-6">
        {footer.legal.map((link) => (
          <a
            href={link.href}
            class="text-gray-500 hover:text-brand-red text-sm transition-colors focus:outline-none focus:ring-2 focus:ring-brand-red focus:ring-offset-2 rounded"
            {...(link.external && { target: "_blank", rel: "noopener noreferrer" })}
          >
            {link.label}
          </a>
        ))}
      </nav>
    </div>
  </div>

  <!-- Emergency Banner -->
  <div class="bg-brand-charcoal text-white">
    <div class="container py-4">
      <div class="flex flex-col sm:flex-row items-center justify-center text-center sm:text-left space-y-2 sm:space-y-0">
        <div class="flex items-center text-sm">
          <svg class="w-4 h-4 mr-2 text-brand-red" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
          </svg>
          <span class="mr-4">24/7 Crisis Support:</span>
          <a href="tel:905-555-HELP" class="font-semibold text-white hover:text-brand-red transition-colors">
            (905) 555-HELP
          </a>
        </div>
        <div class="ml-0 sm:ml-6 text-sm text-gray-300">
          For life-threatening emergencies, call 911
        </div>
      </div>
    </div>
  </div>
</footer>